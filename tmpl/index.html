<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Bulletin Board</title>
	<link rel="stylesheet" href="/static/styles.css">
	<style></style>

	<script src="/static/jquery.js"></script>
	<script src="/static/imgLoader.js"></script>
	<script src="/static/tweakpane-1.5.4.min.js"></script>
</head>

<!--- MARKUP --------------------------------------------------------------->

<body>
	<main class="main">
		<div class="loading">loading...</div>

		<!-- Loads tweakpane here -->
		<section class="customize"></section>
		<button class="btn-icon toggle-customize">
			<img width="20" height="20" src="/static/tool.svg" alt="">
		</button>

		<section class="grid">
			{{range .Images}}
			<img class="item" src="/images/{{.}}"></img>
			{{end}}
		</section>
	</main>

	<div role="dialog" class="dialog-container hide">
		<div class="dialog">
			<button class="closeDialog">close</button>
			<img class="dialogImg" src=""/>
		</div>
	</div>

	<!-- Handle loading / displaying of images -->
	<script>
		const dqs = (s) => document.querySelector(s)
		const gridItemClass = 'item';

		var els = {
			loading: document.querySelector(".loading"),
			grid: document.querySelector(".grid"),
			dialogContainer: dqs('.dialog-container'),
			dialogImg: dqs(".dialogImg"),
			closeDialog: dqs('.closeDialog')
		}
		els.grid.style.display = "none";
		var imagesLoaded = false;

		$('#grid').imagesLoaded()
			.always(function (instance) {
			})
			.done(function (instance) {
				imagesLoaded = true
				els.grid.style.display = "block"
				els.loading.style.display = "none";
				console.log('all images successfully loaded');
			})
			.fail(function () {
				console.log('all images loaded, at least one is broken');
			})

	// Handle Lightbox
	/**
	 * - create a slot element for the current photo
	 * - on click of any photo -> set the element to visible, with a source of the clicked photo
	 * - make it closeable (either `esc` or an `x` or clicking on it again?)
	 * - possible actions - "show in finder/explorer" (would need endpoint for handling that async with Golang.)
	 * */

	// add event listener to body. Check if image el is clicked -- if yes, show in modal. If not, return.
	document.body.addEventListener('click', (e) => {
		if (
			e.target.tagName === 'IMG'
			&& e.target.className === gridItemClass
		) {
			els.dialogContainer.classList.remove('hide');
			// state.dialogImage = e.target.src
			els.dialogImg.src = e.target.src
		} else {
			els.dialogContainer.classList.add('hide');
			els.dialogImg.src = ""
		}
	});

	els.closeDialog.addEventListener('click', () => {
		console.log('close?');
		els.dialogContainer.classList.add('hide');
	});
			
	</script>

	<!-- Tweakpane stuff -->
	<script>
		const pane = new Tweakpane({
			container: document.querySelector(".customize")
		});

		//  Tweakpane show/hide
		const customize = document.querySelector(".customize")
		const customizeBtn = dqs(".toggle-customize")
		customizeBtn.addEventListener("click", (e) => {
			customize.classList.toggle("customize-open")
			customizeBtn.classList.toggle("btn-icon-active")
		})

		const f1 = pane.addFolder({
			title: "Bulletin Board Controls"
		})
		var PARAMS = {
			columns: 4,
			gutter: 8,
			background: {r: 255, g: 255, b: 255},
		};
		// Columns
		f1.addInput(PARAMS, 'columns', { step: 1, min: 0, max: 16 }).on("change", (val) => {
			var grid = document.querySelector(".grid")
			PARAMS.columns = val
			grid.style.columnCount = PARAMS.columns
		})

		// Gutter
		f1.addInput(PARAMS, 'gutter', { step: 1, min: 0, max: 128 }).on("change", (val) => {
			var grid = document.querySelector(".grid")
			var items = document.querySelectorAll(".item")
			for (var i = 0; i < items.length; i++) {
				items[i].style.marginBottom = PARAMS.gutter + "px"
			}
			PARAMS.gutter = val
			grid.style.columnGap = PARAMS.gutter + "px"
		})
		// Background colour
		f1.addInput(PARAMS, 'background').on("change", (val) => {
			var grid = document.querySelector(".grid")
			PARAMS.background = val
			let x = PARAMS.background
			grid.style.backgroundColor = `rgb(${x.r}, ${x.b}, ${x.g})`
		})
	</script>
</body>
</html>
