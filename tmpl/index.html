<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Bulletin Board</title>
	<script src="/static/jquery.js"></script>
	<script src="/static/imgLoader.js"></script>
	<script src="/static/tweakpane-1.5.4.min.js"></script>
	<link rel="stylesheet" href="/static/styles.css">
	<style></style>
</head>

<!--- MARKUP --------------------------------------------------------------->

<body>
	<main>
		<div class="loading">loading...</div>

		<!-- Loads tweakpane here -->
		<section class="customize"></section>
		<button class="btn-icon toggle-customize">
			<img width="20" height="20" src="/static/tool.svg" alt="">
		</button>

		<section class="grid">
			{{range .Images}}
			<img class="item" src="/images/{{.}}"></img>
			{{end}}
		</section>
	</main>
</body>


<!-- Handle loading / displaying of images -->
<script>

	const dqs = (s) => document.querySelector(s)

	var els = {
		loading: document.querySelector(".loading"),
		grid: document.querySelector(".grid")
	}
	els.grid.style.display = "none";
	var imagesLoaded = false;

	$('#grid').imagesLoaded()
		.always(function (instance) {
		})
		.done(function (instance) {
			imagesLoaded = true
			els.grid.style.display = "block"
			els.loading.style.display = "none";
			console.log('all images successfully loaded');
		})
		.fail(function () {
			console.log('all images loaded, at least one is broken');
		})
</script>

<!-- Tweakpane stuff -->
<script>
	const pane = new Tweakpane({
		container: document.querySelector(".customize")
	});

	//  Tweakpane show/hide
	const customize = document.querySelector(".customize")
	const customizeBtn = dqs(".toggle-customize")
	customizeBtn.addEventListener("click", (e) => {
		customize.classList.toggle("customize-open")
		customizeBtn.classList.toggle("btn-icon-active")
	})

	const f1 = pane.addFolder({
		title: "Bulletin Board Controls"
	})
	var PARAMS = {
		columns: 4,
		gutter: 8
	};
	// Columns
	f1.addInput(PARAMS, 'columns', { step: 1, min: 0, max: 16 }).on("change", (val) => {
		var grid = document.querySelector(".grid")
		PARAMS.columns = val
		grid.style.columnCount = PARAMS.columns
	})
	// Gutter
	f1.addInput(PARAMS, 'gutter', { step: 1, min: 0, max: 128 }).on("change", (val) => {
		var grid = document.querySelector(".grid")
		var items = document.querySelectorAll(".item")
		for (var i = 0; i < items.length; i++) {
			items[i].style.marginBottom = PARAMS.gutter + "px"
		}
		PARAMS.gutter = val
		grid.style.columnGap = PARAMS.gutter + "px"
	})


</script>

</html>